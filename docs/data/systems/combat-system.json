{
  "combat_system": {
    "encounter_initialization": {
      "stealth_check": {
        "description": "Fatigue level determines stealth ability vs environment difficulty + monster awareness",
        "fatigue_modifiers": {
          "fresh": "+3 stealth bonus",
          "tired": "+1 stealth bonus",
          "weary": "0 stealth modifier",
          "exhausted": "-2 stealth penalty",
          "critically_fatigued": "-4 stealth penalty"
        },
        "weight_encumbrance_modifiers": {
          "light": "+2 stealth bonus",
          "normal": "0 stealth modifier",
          "overweight": "-2 stealth penalty",
          "encumbered": "-4 stealth penalty"
        },
        "outcomes": {
          "player_advantage": {
            "condition": "Low fatigue + good roll beats monster awareness",
            "result": "Player spots monster first and can choose approach",
            "starting_distance": 5,
            "initiative": "player_first",
            "options": ["sneak_past", "attack", "retreat"]
          },
          "normal_encounter": {
            "condition": "Moderate stealth results",
            "result": "Both notice each other simultaneously",
            "starting_distance": 3,
            "initiative": "player_first",
            "options": ["attack", "retreat", "try_to_communicate"]
          },
          "monster_advantage": {
            "condition": "High fatigue or poor roll allows monster to ambush",
            "result": "Monster gets the drop on tired player",
            "starting_distance": 1,
            "initiative": "monster_first",
            "options": ["defend", "counterattack", "flee"]
          }
        }
      },
      "fatigue_modifiers": {
        "fresh_tired": "Normal starting distance",
        "weary": "Normal starting distance",
        "exhausted": "Starting distance -1 (minimum 0)",
        "critically_fatigued": "Starting distance -2 (minimum 0)"
      }
    },
    "combat_actions": {
      "movement": {
        "advance": {
          "description": "Move 1 distance closer to enemy",
          "range_change": -1,
          "minimum_range": 0,
          "action_cost": "move"
        },
        "retreat": {
          "description": "Move 1 distance away from enemy",
          "range_change": +1,
          "maximum_range": 6,
          "action_cost": "move"
        }
      },
      "attacks": {
        "melee_attack": {
          "description": "Attack with melee weapon",
          "range_requirement": "0-1",
          "damage": "weapon_damage + str_modifier",
          "action_cost": "action"
        },
        "ranged_attack": {
          "description": "Attack with ranged weapon",
          "range_requirement": "weapon_range",
          "damage": "weapon_damage + dex_modifier",
          "action_cost": "action",
          "ammunition_required": true
        },
        "thrown_attack": {
          "description": "Throw weapon or item",
          "range_requirement": "1-3",
          "damage": "weapon_damage + str_modifier",
          "action_cost": "action"
        }
      },
      "special_actions": {
        "defend": {
          "description": "Focus on defense, +2 AC this turn",
          "effect": "+2 AC until next turn",
          "action_cost": "action"
        },
        "flee": {
          "description": "Attempt to escape combat",
          "success_chance": {
            "distance_0-4": "Cannot flee, too close to enemy",
            "distance_5": "50% chance to escape",
            "distance_6": "75% chance to escape"
          },
          "encumbrance_modifiers": {
            "light": "+1 bonus to flee attempts",
            "normal": "No modifier to flee attempts",
            "overweight": "-1 penalty to flee attempts",
            "encumbered": "Cannot flee at distances 0-3"
          },
          "success_result": "Escape combat, gain +1 fatigue",
          "failure_result": "Remain in combat, lose turn",
          "action_cost": "full_turn"
        },
        "use_item": {
          "description": "Use a consumable item",
          "examples": ["healing_potion", "throwing_knife", "oil_flask"],
          "action_cost": "action"
        },
        "cast_spell": {
          "description": "Cast a spell if character has spellcasting ability",
          "requirements": ["spellcasting_class", "sufficient_mana", "spell_known"],
          "action_cost": "varies_by_spell",
          "spell_types": {
            "action_spells": "Use main combat action",
            "bonus_action_spells": "Use bonus action if available",
            "reaction_spells": "Cast in response to triggers"
          },
          "spell_attacks": {
            "ranged_spell_attack": {
              "description": "Roll 1d20 + spellcasting modifier + proficiency",
              "range_mechanics": "Uses spell range like weapons",
              "damage": "Spell damage + spellcasting modifier (if applicable)"
            },
            "automatic_hits": {
              "description": "Spells like Magic Missile automatically hit",
              "examples": ["magic_missile"]
            },
            "saving_throws": {
              "description": "Target rolls save vs spell save DC",
              "spell_save_dc": "8 + proficiency + spellcasting modifier",
              "common_saves": ["dexterity", "constitution", "wisdom"]
            }
          }
        }
      }
    },
    "turn_structure": {
      "player_turn": {
        "move_action": "Optional: Step forward/back",
        "main_action": "Attack, Defend, Use Item, or Flee",
        "bonus_action": "If available from abilities/items"
      },
      "monster_turn": {
        "ai_behavior": "Based on monster type and current range",
        "movement": "Monsters attempt to reach optimal range",
        "attacks": "Use best available attack for current range"
      }
    },
    "range_mechanics": {
      "distance_0": {
        "description": "Grappling range",
        "available_attacks": ["melee", "grapple", "bite"],
        "movement_restriction": "Both creatures engaged"
      },
      "distance_1": {
        "description": "Melee range",
        "available_attacks": ["melee", "thrown"],
        "optimal_for": "Swords, axes, daggers"
      },
      "distance_2-3": {
        "description": "Close ranged combat",
        "available_attacks": ["ranged", "thrown", "reach_weapons"],
        "optimal_for": "Shortbows, crossbows, spears"
      },
      "distance_4-6": {
        "description": "Long range",
        "available_attacks": ["ranged_long"],
        "optimal_for": "Longbows, heavy crossbows"
      }
    },
    "weapon_effectiveness": {
      "melee_weapons": {
        "effective_range": "0-1",
        "penalty_beyond": "-2 to hit per distance beyond range"
      },
      "ranged_weapons": {
        "short_range": "No penalty within weapon range",
        "long_range": "-2 to hit within weapon range_long",
        "beyond_long": "Cannot attack beyond range_long"
      },
      "reach_weapons": {
        "effective_range": "1-2",
        "cannot_attack": "Range 0 (too close)"
      }
    },
    "weight_encumbrance_effects": {
      "description": "How carrying weight affects combat performance",
      "combat_modifiers": {
        "light": {
          "attack_bonus": "+1 to attack rolls",
          "ac_bonus": "+1 to AC",
          "initiative_bonus": "+1 to initiative"
        },
        "normal": {
          "attack_bonus": 0,
          "ac_bonus": 0,
          "initiative_bonus": 0
        },
        "overweight": {
          "attack_penalty": "-1 to attack rolls",
          "ac_penalty": "-1 to AC",
          "initiative_penalty": "-1 to initiative"
        },
        "encumbered": {
          "attack_penalty": "-3 to attack rolls",
          "ac_penalty": "-3 to AC",
          "initiative_penalty": "-2 to initiative",
          "movement_restriction": "Cannot retreat if at distance 0"
        }
      }
    },
    "combat_resolution": {
      "victory_conditions": {
        "monster_defeated": "Monster HP reaches 0",
        "player_victory": "Gain XP, loot, and gems",
        "successful_flee": "Escape without loot, gain 1 fatigue"
      },
      "defeat_conditions": {
        "player_hp_zero": "Player is knocked unconscious",
        "consequences": "Lose items, wake up at nearest safe location"
      }
    }
  }
}