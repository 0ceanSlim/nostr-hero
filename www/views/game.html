{{define "title"}}Nostr Hero - Game{{end}}

{{define "view"}}
    <!-- Hidden Game State Storage -->
    <div id="game-state" style="display: none;">
        <div id="character-data">
            {"hp": 0, "max_hp": 0, "mana": 0, "max_mana": 0, "location": "", "fatigue": 0}
        </div>
        <div id="inventory-data">
            []
        </div>
        <div id="equipment-data">
            {}
        </div>
        <div id="spell-data">
            []
        </div>
        <div id="location-data">
            {"current": "", "discovered": []}
        </div>
        <div id="combat-data">
            null
        </div>
    </div>

    <!-- Static Game Data Storage -->
    <div id="static-data" style="display: none;">
        <div id="all-items">[]</div>
        <div id="all-spells">[]</div>
        <div id="all-monsters">[]</div>
        <div id="all-locations">[]</div>
        <div id="all-packs">[]</div>
    </div>

    <!-- Main Game Container -->
    <div id="game-app" class="container mx-auto p-4">
        <!-- Game Header -->
        <div class="bg-gray-800 rounded-lg p-4 mb-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-yellow-400">Nostr Hero</h1>
                <div class="flex space-x-2">
                    <button id="save-btn"
                            onclick="saveGameToLocal()"
                            class="bg-yellow-600 hover:bg-yellow-700 text-gray-900 px-4 py-2 rounded font-bold">
                        ðŸ’¾ Save Game
                    </button>
                    <button onclick="exportSave()"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold">
                        ðŸ“¦ Export
                    </button>
                    <button onclick="window.location.href='/saves'"
                            class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded font-bold">
                        ðŸ“‚ Saves
                    </button>
                    <button onclick="logout()"
                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold">
                        ðŸšª Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Character Panel -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div id="character-panel" class="bg-gray-800 rounded-lg p-4">
                <h2 class="text-xl font-bold mb-3 text-green-400">Character</h2>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>HP:</span>
                        <span><span id="current-hp">0</span>/<span id="max-hp">0</span></span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-2">
                        <div id="hp-bar" class="bg-red-500 h-2 rounded-full transition-all" style="width: 100%"></div>
                    </div>
                    <div class="flex justify-between">
                        <span>Mana:</span>
                        <span><span id="current-mana">0</span>/<span id="max-mana">0</span></span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-2">
                        <div id="mana-bar" class="bg-blue-500 h-2 rounded-full transition-all" style="width: 100%"></div>
                    </div>
                    <div class="flex justify-between">
                        <span>Fatigue:</span>
                        <span id="fatigue-level">0</span>
                    </div>
                </div>
            </div>

            <!-- Inventory Panel -->
            <div id="inventory-panel" class="bg-gray-800 rounded-lg p-4">
                <h2 class="text-xl font-bold mb-3 text-blue-400">Inventory</h2>
                <div id="inventory-list" class="space-y-1 max-h-32 overflow-y-auto">
                    <!-- Inventory items will be populated here -->
                </div>
            </div>

            <!-- Spells Panel -->
            <div id="spells-panel" class="bg-gray-800 rounded-lg p-4">
                <h2 class="text-xl font-bold mb-3 text-purple-400">Spells</h2>
                <div id="spells-list" class="space-y-1 max-h-32 overflow-y-auto">
                    <!-- Prepared spells will be populated here -->
                </div>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="bg-gray-800 rounded-lg p-6">
            <!-- Location Display -->
            <div id="location-panel">
                <h2 id="location-name" class="text-2xl font-bold mb-4 text-yellow-400"></h2>
                <p id="location-description" class="text-gray-300 mb-6 leading-relaxed"></p>

                <!-- Location Actions -->
                <div id="location-actions" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- Actions will be populated dynamically -->
                </div>
            </div>

            <!-- Combat Interface (Hidden by default) -->
            <div id="combat-interface" class="hidden mt-6 border-t border-gray-600 pt-6">
                <h3 class="text-xl font-bold mb-4 text-red-400">Combat</h3>
                <div id="combat-status" class="mb-4">
                    <!-- Combat status will be displayed here -->
                </div>
                <div id="combat-actions" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <!-- Combat actions will be populated here -->
                </div>
            </div>
        </div>

        <!-- Message Area -->
        <div id="message-area" class="fixed bottom-4 right-4 max-w-sm space-y-2 z-50">
            <!-- Messages will appear here -->
        </div>
    </div>

    <!-- Game Logic Scripts - Load in correct order -->
    <script src="/res/js/session-manager.js"></script>
    <script src="/res/js/game-ui.js"></script>
    <script src="/res/js/auth.js"></script>
    <script src="/res/js/character-generator.js"></script>
    <script src="/res/js/game-state.js"></script>
    <script src="/res/js/game-logic.js"></script>
    <script src="/res/js/save-system.js"></script>
    <script src="/res/js/startup.js"></script>
{{end}}