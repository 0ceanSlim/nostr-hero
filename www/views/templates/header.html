{{define "header"}}

<header class="p-2 sm:p-3 win95-inset rounded-b-md sticky top-0 z-50" style="background-color: var(--color-bgPrimary);">
  <div class="relative flex items-center justify-between gap-2 sm:gap-4">
    <!-- Left: Logo + Version -->
    <div class="flex items-center gap-2 min-w-0 flex-shrink">
      {{template "app-name"}}
      <span class="hidden md:inline text-xs whitespace-nowrap" style="color: var(--color-textMuted);">x.x.x</span>
    </div>

    <!-- Right: Compact controls -->
    <div class="flex items-center gap-1 sm:gap-2 flex-shrink-0">
      <!-- Login/Profile Button (Always visible) -->
      {{template "nav-play" .}}

      <!-- Theme Switcher (Always visible, far right) -->
      <div class="relative flex-shrink-0">
        <button
          onclick="toggleThemeDropdown()"
          id="theme-switcher-btn"
          class="win95-button pixel-clip p-2 hover:opacity-80 transition flex-shrink-0"
          title="Change theme"
          style="color: var(--color-textPrimary);"
        >
          ðŸŽ¨
        </button>

        <!-- Theme Dropdown -->
        <div
          id="theme-dropdown"
          class="absolute right-0 hidden mt-2 win95-outset pixel-clip shadow-lg"
          style="min-width: 10rem; z-index: 60; border: 2px solid var(--color-textPrimary);"
        >
          <div class="py-1">
            <button onclick="selectThemeQuick('dark')" class="theme-quick-option w-full text-left px-3 py-2 text-sm hover:bg-opacity-20" style="color: var(--color-textPrimary);" onmouseover="this.style.backgroundColor='var(--color-textHighlighted)'; this.style.color='var(--color-bgPrimary)'" onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-textPrimary)'">
              <span class="inline-block w-3 h-3 mr-2 rounded-sm" style="background: rgb(16, 16, 16); border: 1px solid #fff;"></span> Dark
            </button>
            <button onclick="selectThemeQuick('light')" class="theme-quick-option w-full text-left px-3 py-2 text-sm hover:bg-opacity-20" style="color: var(--color-textPrimary);" onmouseover="this.style.backgroundColor='var(--color-textHighlighted)'; this.style.color='var(--color-bgPrimary)'" onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-textPrimary)'">
              <span class="inline-block w-3 h-3 mr-2 rounded-sm" style="background: rgb(230, 230, 230); border: 1px solid #000;"></span> Light
            </button>
            <button onclick="selectThemeQuick('midnight')" class="theme-quick-option w-full text-left px-3 py-2 text-sm hover:bg-opacity-20" style="color: var(--color-textPrimary);" onmouseover="this.style.backgroundColor='var(--color-textHighlighted)'; this.style.color='var(--color-bgPrimary)'" onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-textPrimary)'">
              <span class="inline-block w-3 h-3 mr-2 rounded-sm" style="background: rgb(25, 24, 48); border: 1px solid #fff;"></span> Midnight
            </button>
            <button onclick="selectThemeQuick('lava')" class="theme-quick-option w-full text-left px-3 py-2 text-sm hover:bg-opacity-20" style="color: var(--color-textPrimary);" onmouseover="this.style.backgroundColor='var(--color-textHighlighted)'; this.style.color='var(--color-bgPrimary)'" onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-textPrimary)'">
              <span class="inline-block w-3 h-3 mr-2 rounded-sm" style="background: rgb(57, 0, 0); border: 1px solid #fff;"></span> Lava
            </button>
            <button onclick="selectThemeQuick('solar')" class="theme-quick-option w-full text-left px-3 py-2 text-sm hover:bg-opacity-20" style="color: var(--color-textPrimary);" onmouseover="this.style.backgroundColor='var(--color-textHighlighted)'; this.style.color='var(--color-bgPrimary)'" onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-textPrimary)'">
              <span class="inline-block w-3 h-3 mr-2 rounded-sm" style="background: rgb(0, 43, 54); border: 1px solid #fff;"></span> Solar
            </button>
            <button onclick="selectThemeQuick('matrix')" class="theme-quick-option w-full text-left px-3 py-2 text-sm hover:bg-opacity-20" style="color: var(--color-textPrimary);" onmouseover="this.style.backgroundColor='var(--color-textHighlighted)'; this.style.color='var(--color-bgPrimary)'" onmouseout="this.style.backgroundColor=''; this.style.color='var(--color-textPrimary)'">
              <span class="inline-block w-3 h-3 mr-2 rounded-sm" style="background: rgb(0, 0, 0); border: 1px solid #0f0;"></span> Matrix
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  function toggleNav() {
    const navbar = document.getElementById("navbar");
    navbar.classList.toggle("hidden");
  }
  function toggleDropdown(id) {
    const dropdown = document.getElementById(id);
    dropdown.classList.toggle("hidden");
  }

  // Theme dropdown toggle
  function toggleThemeDropdown() {
    const dropdown = document.getElementById('theme-dropdown');
    dropdown.classList.toggle('hidden');
  }

  // Quick theme selection from header
  function selectThemeQuick(themeName) {
    if (window.themeManager) {
      window.themeManager.setTheme(themeName);
    }
    // Close dropdown
    const dropdown = document.getElementById('theme-dropdown');
    if (dropdown) dropdown.classList.add('hidden');
  }

  // Close dropdowns when clicking outside
  document.addEventListener('click', function(event) {
    const themeDropdown = document.getElementById('theme-dropdown');
    const themeButton = document.getElementById('theme-switcher-btn');

    if (themeDropdown && themeButton &&
        !themeDropdown.contains(event.target) &&
        !themeButton.contains(event.target)) {
      themeDropdown.classList.add('hidden');
    }
  });

</script>

{{end}}
