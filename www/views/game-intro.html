{{define "title"}}Nostr Hero - New Adventure{{end}} {{define "view"}}
<!-- Google Fonts - Handwritten font for letter -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap"
  rel="stylesheet"
/>

<script src="/scripts/core/session-manager.js"></script>
<script src="/scripts/systems/character-generator.js"></script>
<script src="/scripts/components/continue-button.js"></script>
<script src="/scripts/components/back-button.js"></script>
<script src="/scripts/systems/equipment-selection.js"></script>
<script src="/scripts/pages/game-intro.js"></script>

<style>
  /* Mobile landscape orientation lock */
  @media screen and (max-width: 768px) {
    /* Force landscape orientation message for portrait mode */
    body::before {
      content: "";
      display: none;
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 9999;
    }

    body::after {
      content: "Please rotate your device to landscape mode";
      display: none;
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      font-size: 1.5rem;
      text-align: center;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      padding: 2rem;
      font-family: "Dogica", monospace;
    }

    /* Show rotation message in portrait mode */
    @media (orientation: portrait) {
      body::before,
      body::after {
        display: flex;
      }

      /* Hide all content in portrait mode */
      body > *:not(::before):not(::after) {
        display: none !important;
      }
    }

    /* Landscape mode optimizations */
    @media (orientation: landscape) {
      /* Scale down text and elements for mobile landscape */
      .scene-text {
        font-size: 1rem !important;
        max-width: 90vw;
      }

      .letter-container {
        width: 25vw !important;
        min-width: 200px !important;
        max-width: 280px !important;
        height: 70vh !important;
        font-size: 0.875rem !important;
        padding: 1rem !important;
        line-height: 1.2 !important;
      }

      #typed-question {
        font-size: 1.25rem !important;
      }

      #character-name {
        font-size: 1rem !important;
        padding: 0.5rem 1rem !important;
        min-width: auto !important;
        width: 80vw !important;
        max-width: 300px !important;
      }

      #continue-btn,
      .pixel-continue-btn {
        font-size: 1rem !important;
        padding: 0.75rem 1.5rem !important;
        margin-top: 1rem !important;
      }

      .pixel-skip-btn {
        font-size: 0.625rem !important;
        padding: 0.4rem 0.8rem !important;
        top: 0.5rem !important;
        right: 0.5rem !important;
      }

      /* Equipment selection mobile adjustments */
      #equipment-selection > div {
        padding: 1rem !important;
        max-height: 90vh !important;
      }

      #equipment-selection h2 {
        font-size: 1.5rem !important;
        margin-bottom: 1rem !important;
      }

      #equipment-selection h4 {
        font-size: 1rem !important;
      }

      /* Item cards in equipment selection - smaller on mobile */
      .item-card {
        width: 70px !important;
        height: 70px !important;
      }

      /* Adjust item card text for smaller size */
      .item-card .item-name {
        font-size: 0.5rem !important;
        line-height: 0.6rem !important;
        padding: 0.25rem 0.125rem !important;
      }

      .item-card img {
        padding: 0.5rem !important;
      }

      .item-card .info-btn {
        font-size: 12px !important;
        bottom: 0.25rem !important;
        right: 0.25rem !important;
      }

      /* Scene content titles for equipment choices */
      #scene-content .text-xl,
      #scene-content .text-2xl {
        font-size: 1rem !important;
        margin-bottom: 0.75rem !important;
      }

      /* Scrollable containers in equipment scenes */
      #scene-content .overflow-y-auto {
        max-height: calc(100vh - 150px) !important;
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
      }

      /* Bundle and pack containers */
      #scene-content [data-option-index] {
        padding: 0.5rem !important;
      }

      /* Bundle labels */
      #scene-content .text-xs {
        font-size: 0.625rem !important;
      }

      /* Item grids in equipment selection */
      #scene-content .grid {
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 0.5rem !important;
      }

      /* Flex containers for items */
      #scene-content .flex-wrap {
        gap: 0.5rem !important;
      }

      /* Pack/bundle titles */
      #scene-content .text-yellow-400.font-bold {
        font-size: 0.875rem !important;
        margin-bottom: 0.5rem !important;
      }

      #scene-content .text-green-400.font-bold {
        font-size: 0.875rem !important;
        margin-bottom: 0.5rem !important;
      }

      /* Separator text (OR) */
      #scene-content .text-yellow-400.text-xl {
        font-size: 0.875rem !important;
        margin-top: 0.5rem !important;
        margin-bottom: 0.5rem !important;
      }

      /* Confirm/Continue buttons in equipment selection */
      #scene-content .pixel-continue-btn {
        font-size: 0.875rem !important;
        padding: 0.6rem 1.2rem !important;
        margin-top: 0.75rem !important;
      }

      /* Back button */
      .pixel-back-btn {
        font-size: 0.625rem !important;
        padding: 0.4rem 0.8rem !important;
        bottom: 0.5rem !important;
        left: 0.5rem !important;
      }

      /* Weapon slot descriptions */
      #scene-content .space-y-2 > div {
        font-size: 0.75rem !important;
      }

      /* Configuration containers */
      #scene-content .p-6 {
        padding: 0.75rem !important;
      }

      /* Final confirmation screen */
      #scene-content .max-w-md {
        font-size: 0.875rem !important;
      }

      #continue-adventure-btn {
        font-size: 1rem !important;
        padding: 0.75rem 1.5rem !important;
      }
    }
  }

  /* Scene animations */
  @keyframes wipeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes wipeOut {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-20px);
    }
  }

  @keyframes fadeInSentence {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Equipment selection wipe animations */
  @keyframes wipeRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }

  @keyframes wipeLeft {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(-100%);
      opacity: 0;
    }
  }

  @keyframes slideInFromLeft {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideInFromRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .scene-container {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
  }

  .scene-container.fade-in {
    opacity: 1;
  }

  .scene-container.fade-out {
    opacity: 0;
  }

  .scene-background {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    z-index: 0;
    transition: opacity 0.8s ease-in-out;
  }

  .scene-text {
    opacity: 0;
    animation: wipeIn 0.8s ease-out forwards;
    animation-delay: 1s;
    position: relative;
    z-index: 1;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9),
      -1px -1px 4px rgba(0, 0, 0, 0.8);
  }

  .letter-container {
    position: absolute;
    color: #1a1a1a;
    padding: 1.5rem 2rem;
    overflow-y: auto;
    font-family: "Caveat", cursive;
    font-weight: 400;
    font-size: 1.5rem;
    line-height: 1;
    text-align: left;
    z-index: 1;
    /* Position to match the black letter area in the background */
    top: 54%;
    left: 50%;
    transform: translate(-50%, -50%);
    /* Size to fit within the letter area - narrower for better fit, taller for more text */
    width: 28vw;
    max-width: 380px;
    min-width: 280px;
    height: 58vh;
    max-height: 580px;
    /* Transparent background to show the letter texture beneath */
    background: transparent;
    /* Ensure text is readable */
    text-shadow: 0 0 2px rgba(255, 255, 255, 0.3);
  }

  /* Continue Button - Pixelated yellow button */
  .pixel-continue-btn {
    display: inline-block;
    padding: 1rem 2rem;
    font-size: 1.25rem;
    font-weight: bold;
    margin-top: 2rem;
    cursor: pointer;
    position: relative;
    z-index: 1;
    background: #ffd700;
    color: #000000;
    border: none;
    text-shadow: none;
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
    /* Pixelated corners using clip-path */
    clip-path: polygon(
      0 4px, 4px 4px, 4px 0,
      calc(100% - 4px) 0, calc(100% - 4px) 4px, 100% 4px,
      100% calc(100% - 4px), calc(100% - 4px) calc(100% - 4px), calc(100% - 4px) 100%,
      4px 100%, 4px calc(100% - 4px), 0 calc(100% - 4px)
    );
    box-shadow:
      inset 2px 2px 0 #ffed4e,
      inset -2px -2px 0 #cc9900,
      4px 4px 0 rgba(0, 0, 0, 0.3);
  }

  .pixel-continue-btn:hover {
    background: #ffed4e;
  }

  .pixel-continue-btn:active {
    box-shadow:
      inset -2px -2px 0 #ffed4e,
      inset 2px 2px 0 #cc9900,
      2px 2px 0 rgba(0, 0, 0, 0.3);
    transform: translate(2px, 2px);
  }

  /* Back Button - uses Win95 button from input.css */
  .pixel-back-btn {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    font-weight: bold;
    cursor: pointer;
    position: fixed;
    bottom: 1.5rem;
    left: 1.5rem;
    z-index: 100;
  }

  /* Skip Scene Button - uses Win95 button from input.css */
  .pixel-skip-btn {
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
    font-weight: bold;
    cursor: pointer;
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    z-index: 100;
  }

  /* Item Card Styles */
  .item-card {
    border: none;
  }

  /* Container selection styles (for bundle and simple item containers) */
  [data-option-index] {
    transition: all 0.2s ease;
    box-sizing: border-box;
  }

  [data-option-index]:hover:not(.selected) {
    border-color: var(--color-textHighlighted) !important;
  }

  [data-option-index].selected {
    border-color: var(--color-textHighlighted) !important;
    border-width: 3px !important;
    box-shadow: 0 0 20px var(--color-textHighlighted) !important;
    background-color: var(--color-bgTertiary) !important;
    box-sizing: border-box;
  }

  [data-option-index].selected .info-btn {
    pointer-events: auto !important;
  }
</style>

<!-- Full-screen black background -->
<div class="fixed inset-0 z-50 text-white bg-black">
  <!-- Initial name input screen -->
  <div
    id="name-screen"
    class="relative z-10 flex flex-col items-center justify-center h-full"
  >
    <div id="typed-question" class="px-4 mb-8 text-xl text-center md:text-2xl">
      What is your name?
    </div>
    <div id="name-input-container" class="flex flex-col items-center space-y-4">
      <input
        type="text"
        id="character-name"
        class="px-6 py-3 text-xl text-center rounded-lg win95-inset focus:outline-none min-w-72"
        style="
          color: var(--color-textPrimary);
          background-color: var(--color-bgSecondary);
        "
        placeholder="Enter your name..."
        maxlength="20"
        onkeydown="if(event.key==='Enter') document.getElementById('continue-btn').click()"
      />
      <button
        id="continue-btn"
        class="px-8 py-3 text-lg font-bold rounded-lg win95-button"
        style="color: var(--color-textPrimary)"
        onclick="startIntroSequence()"
      >
        Begin Your Story
      </button>
    </div>
  </div>

  <!-- Universal Scene Container -->
  <div id="scene-container" class="hidden scene-container">
    <div id="scene-background" class="scene-background"></div>
    <div id="scene-content" class="max-w-4xl px-8 text-center"></div>
  </div>

  <!-- Equipment Selection Screen -->
  <div id="equipment-selection" class="hidden">
    <div
      class="w-full max-w-6xl max-h-full p-8 overflow-y-auto win95-outset rounded-2xl"
    >
      <h2
        class="mb-8 text-3xl font-bold text-center"
        style="color: var(--color-textHighlighted)"
      >
        Choose Your Equipment
      </h2>
      <div id="equipment-choices" class="space-y-6"></div>

      <div class="mt-6">
        <h4
          class="mb-3 text-lg font-medium"
          style="color: var(--color-textSecondary)"
        >
          Starting Inventory:
        </h4>
        <div
          id="starting-inventory"
          class="grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-3"
        ></div>
      </div>

      <div class="mt-8 text-center">
        <button
          id="continue-adventure-btn"
          class="px-8 py-4 text-xl font-bold rounded-lg win95-button"
          style="color: var(--color-textPrimary); display: none"
          onclick="continueAfterEquipment()"
        >
          Continue →
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Audio elements -->
<audio id="intro-music">
  <source
    src="/res/aud/newgame1_medieval-lofi-nokron-the-eternal-city.mp3"
    type="audio/mpeg"
  />
</audio>

<audio id="game-music">
  <source
    src="/res/aud/load_medieval-lofi-cycle-of-life.mp3"
    type="audio/mpeg"
  />
</audio>

{{end}}
